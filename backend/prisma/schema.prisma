generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int      @id @default(autoincrement())
  nombre       String
  email        String   @unique
  passwordHash String
  rol          String
}

model Team {
  id     Int    @id @default(autoincrement())
  nombre String
  logo   String?
  players Player[]
  homeGames Game[] @relation("HomeTeam")
  awayGames Game[] @relation("AwayTeam")
}

model Player {
  id        Int    @id @default(autoincrement())
  nombre    String
  apellido  String
  numero    Int
  posicion  String
  teamId    Int
  team      Team    @relation(fields: [teamId], references: [id])
  stats     PlayerGameStats[]
  substitutionsIn Substitution[] @relation("PlayerIn")
  substitutionsOut Substitution[] @relation("PlayerOut")
  activeInGames Game[] @relation("ActivePlayers")
}

model Event {
  id          Int    @id @default(autoincrement())
  nombre      String
  fechaInicio DateTime
  fechaFin    DateTime
  games       Game[]
}

model Game {
  id         Int    @id @default(autoincrement())
  eventId    Int
  event      Event  @relation(fields: [eventId], references: [id])
  teamHomeId Int
  teamAwayId Int
  teamHome   Team   @relation("HomeTeam", fields: [teamHomeId], references: [id])
  teamAway   Team   @relation("AwayTeam", fields: [teamAwayId], references: [id])
  fecha      DateTime
  estado     String
  gameTime   Int      @default(0)
  homeScore  Int      @default(0)
  awayScore  Int      @default(0)
  
  // Quarter management
  currentQuarter    Int     @default(1)
  quarterLength     Int     @default(720)     // Quarter length in seconds (12 minutes = 720 seconds)
  totalQuarters     Int     @default(4)       // Total quarters in regulation
  overtimeLength    Int     @default(300)     // Overtime length in seconds (5 minutes = 300 seconds)
  quarterTime       Int     @default(0)       // Current quarter time in seconds
  isOvertime        Boolean @default(false)   // Is game in overtime
  
  stats      PlayerGameStats[]
  substitutions Substitution[]
  activePlayers Player[] @relation("ActivePlayers")
}

model PlayerGameStats {
  id               Int    @id @default(autoincrement())
  gameId           Int
  playerId         Int
  puntos           Int
  rebotes          Int
  asistencias      Int
  robos            Int
  tapones          Int
  tirosIntentados  Int
  tirosAnotados    Int
  tiros3Intentados Int
  tiros3Anotados   Int
  minutos          Int
  plusMinus        Int
  game             Game   @relation(fields: [gameId], references: [id])
  player           Player @relation(fields: [playerId], references: [id])
  
  @@unique([gameId, playerId])
}

model Substitution {
  id         Int    @id @default(autoincrement())
  gameId     Int
  playerInId Int
  playerOutId Int
  timestamp  DateTime
  game       Game   @relation(fields: [gameId], references: [id])
  playerIn   Player @relation("PlayerIn", fields: [playerInId], references: [id])
  playerOut  Player @relation("PlayerOut", fields: [playerOutId], references: [id])
}
